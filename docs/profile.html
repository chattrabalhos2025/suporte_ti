<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minha Conta | Suporte T√©cnico</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      scroll-behavior: smooth;
    }

    .animated-bg {
      background:
        radial-gradient(circle at top, rgba(56,189,248,0.18), transparent 55%),
        radial-gradient(circle at bottom, rgba(129,140,248,0.2), transparent 55%),
        #020617;
    }
  </style>
</head>
<body class="min-h-screen animated-bg text-slate-50">

  <!-- TOP NAV -->
  <header class="border-b border-white/10 bg-slate-950/70 backdrop-blur">
    <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="relative">
          <img
            src="logo-helptech.png"
            alt="Logo HelpTech"
            class="h-8 w-auto rounded-xl shadow shadow-sky-500/40"
          />
          <span class="absolute -bottom-1 -right-1 h-3 w-3 rounded-full bg-emerald-400 border border-slate-900"></span>
        </div>
        <div class="flex flex-col leading-tight">
          <span
            id="headerSubtitle"
            class="text-[11px] uppercase tracking-[0.18em] text-slate-400"
          >
            Painel do Usu√°rio
          </span>
          <h1 id="headerTitle" class="text-lg font-semibold text-slate-50">
            Minha Conta
          </h1>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <a
          id="linkPainelChamados"
          href="dashboard.html"
          class="hidden sm:inline-flex items-center gap-2 rounded-2xl border border-white/10 px-3 py-2 text-xs font-medium text-slate-200 hover:bg-white/10 hover:-translate-y-[1px] transition"
        >
          ‚¨Ö Voltar para o sistema
        </a>
        <button
          id="logoutTop"
          class="inline-flex items-center gap-2 rounded-2xl bg-red-500/90 px-3 py-2 text-xs font-semibold text-white hover:bg-red-500 hover:-translate-y-[1px] shadow-sm transition"
        >
          Sair
        </button>
      </div>
    </div>
  </header>

  <!-- MAIN WRAPPER -->
  <main class="max-w-5xl mx-auto px-4 py-8">
    <div class="grid lg:grid-cols-[minmax(0,1.15fr)_minmax(0,1.2fr)] gap-6">

      <!-- COLUNA ESQUERDA - PERFIL / SIDEBAR -->
      <aside class="bg-slate-950/70 border border-white/10 rounded-3xl p-6 space-y-6 shadow-2xl shadow-black/50 backdrop-blur">

        <!-- AVATAR E NOME -->
        <section class="flex items-center gap-4">
          <div class="relative">
            <div
              id="avatarWrapper"
              class="w-20 h-20 rounded-2xl bg-slate-800 border border-white/10 overflow-hidden flex items-center justify-center shadow-xl shadow-black/60"
            >
              <img id="avatarImg" alt="Foto do usu√°rio" class="w-full h-full object-cover hidden">
              <span id="avatarInitials" class="text-slate-100 font-semibold text-xl">??</span>
            </div>
            <button
              type="button"
              id="btnChangeAvatar"
              class="absolute -bottom-1 -right-1 inline-flex items-center justify-center w-7 h-7 rounded-xl bg-slate-100 text-slate-900 text-xs shadow hover:bg-slate-200 transition"
              title="Alterar foto"
            >
              üì∑
            </button>
            <input id="avatarInput" type="file" accept="image/*" class="hidden">
          </div>

          <div class="flex flex-col gap-1">
            <p class="text-xs uppercase tracking-[0.16em] text-slate-400">
              Usu√°rio autenticado
            </p>
            <div class="flex items-center gap-2">
              <h2 class="text-xl font-semibold" id="pNome">‚Äî</h2>
              <span
                id="chipPerfil"
                class="inline-flex items-center rounded-full bg-slate-800 border border-white/15 px-2 py-[2px] text-[10px] font-semibold text-slate-200"
              >
                ‚Äî
              </span>
            </div>
            <p class="text-sm text-slate-300 flex items-center gap-1" id="pEmail">‚Äî</p>
          </div>
        </section>

        <!-- STATUS / PERFIL / CHAMADOS -->
        <section class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm">
          <div class="rounded-2xl border border-emerald-400/30 bg-emerald-900/20 px-3 py-2.5">
            <p class="text-[11px] uppercase tracking-[0.16em] text-emerald-300 mb-1">Status</p>
            <p class="font-semibold text-emerald-100 flex items-center gap-1">
              <span class="text-xs">‚óè</span> Ativo
            </p>
          </div>
          <div class="rounded-2xl border border-slate-500/40 bg-slate-900/40 px-3 py-2.5">
            <p class="text-[11px] uppercase tracking-[0.16em] text-slate-400 mb-1">Perfil</p>
            <p class="font-semibold text-slate-100" id="perfilTexto">Usu√°rio Padr√£o</p>
          </div>
          <div class="rounded-2xl border border-indigo-400/30 bg-indigo-900/20 px-3 py-2.5">
            <p class="text-[11px] uppercase tracking-[0.16em] text-indigo-300 mb-1">Chamados</p>
            <p class="font-semibold text-indigo-100" id="userChamadosCount">‚Äî</p>
          </div>
        </section>

        <!-- DADOS B√ÅSICOS -->
        <section class="space-y-3">
          <div class="flex items-center justify-between">
            <h3 class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
              Dados cadastrais
            </h3>
            <button
              id="btnOpenEditModal"
              class="inline-flex items-center gap-1 rounded-xl border border-white/15 px-2.5 py-1.5 text-[11px] font-medium text-slate-100 hover:bg-white/10 transition"
            >
              ‚úèÔ∏è Editar
            </button>
          </div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between items-center gap-3">
              <span class="text-slate-400">CPF</span>
              <span class="font-medium text-slate-100" id="pCPF">‚Äî</span>
            </div>
            <div class="flex justify-between items-center gap-3">
              <span class="text-slate-400">Telefone</span>
              <span class="font-medium text-slate-100" id="pTel">‚Äî</span>
            </div>
          </div>
        </section>

        <!-- NAVEGA√á√ÉO -->
        <section class="space-y-3">
          <h3 class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
            Navega√ß√£o
          </h3>
          <div class="flex flex-col gap-2 text-sm">
            <button
              type="button"
              id="btnAtualResumo"
              class="inline-flex items-center justify-between rounded-2xl border border-white/10 bg-white/5 px-3 py-2 hover:bg-white/10 transition"
            >
              <span>Resumo da conta (atual)</span>
              <span class="text-xs text-slate-300">Dashboard</span>
            </button>
            <a
              href="dashboard.html"
              id="linkPainelChamadosSidebar"
              class="inline-flex items-center justify-between rounded-2xl border border-white/5 px-3 py-2 hover:bg-white/10 transition"
            >
              <span>Ir para painel de chamados</span>
              <span class="text-xs text-slate-300">Home</span>
            </a>
          </div>
        </section>
      </aside>

      <!-- COLUNA DIREITA - SEGURAN√áA / A√á√ïES / CONFIG AVAN√áADAS-->
      <section class="space-y-6">

        <!-- CARD SEGURAN√áA DA CONTA -->
        <div class="bg-slate-950/70 border border-white/10 rounded-3xl p-6 shadow-2xl shadow-black/50 backdrop-blur space-y-5">
          <div class="flex items-center justify-between gap-3">
            <div>
              <h2 class="text-base font-semibold text-slate-50 flex items-center gap-2">
                Seguran√ßa da Conta
                <span class="inline-flex items-center rounded-full bg-emerald-500/15 border border-emerald-400/40 px-2 py-[2px] text-[10px] font-semibold text-emerald-200">
                  Recomendado
                </span>
              </h2>
              <p class="text-sm text-slate-300 mt-1">
                Gerencie a sua senha, aumente a seguran√ßa da conta e mantenha as informa√ß√µes sempre atualizadas.
              </p>
            </div>
            <button
              id="btnChangePassword"
              class="hidden sm:inline-flex items-center gap-2 rounded-xl border border-white/10 px-3 py-2 text-xs font-medium text-slate-100 hover:bg-white/10 transition"
            >
              Alterar senha
            </button>
          </div>

          <!-- Bot√£o mobile -->
          <button
            id="btnChangePasswordMobile"
            class="sm:hidden w-full inline-flex justify-center rounded-2xl border border-white/10 px-3 py-2.5 text-sm font-medium text-slate-50 hover:bg-white/10 transition"
          >
            Alterar senha
          </button>

          <!-- SE√á√ÉO ALTERAR SENHA -->
          <div id="changePasswordSection" class="hidden pt-4 border-t border-white/10">
            <form id="formChangePassword" class="grid gap-4 mt-2">
              <!-- Senha atual -->
              <div class="relative">
                <label class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300" for="currentPassword">
                  Senha atual
                </label>
                <input
                  id="currentPassword"
                  type="password"
                  required
                  class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 pr-10 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
                  placeholder="Digite sua senha atual"
                >
                <button
                  type="button"
                  class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400 hover:text-slate-100 text-sm mt-6"
                  id="toggleCurrentPassword"
                  aria-label="Mostrar ou ocultar senha atual"
                >
                  üëÅÔ∏è
                </button>
              </div>

              <!-- Nova senha -->
              <div class="relative">
                <label class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300" for="newPassword">
                  Nova senha
                </label>
                <input
                  id="newPassword"
                  type="password"
                  required
                  minlength="6"
                  class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 pr-10 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
                  placeholder="M√≠nimo de 6 caracteres"
                >
                <button
                  type="button"
                  class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400 hover:text-slate-100 text-sm mt-6"
                  id="toggleNewPassword"
                  aria-label="Mostrar ou ocultar nova senha"
                >
                  üëÅÔ∏è
                </button>
              </div>

              <!-- Confirma√ß√£o nova senha -->
              <div class="relative">
                <label class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300" for="confirmPassword">
                  Confirmar nova senha
                </label>
                <input
                  id="confirmPassword"
                  type="password"
                  required
                  minlength="6"
                  class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 pr-10 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
                  placeholder="Repita a nova senha"
                >
                <button
                  type="button"
                  class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400 hover:text-slate-100 text-sm mt-6"
                  id="toggleConfirmPassword"
                  aria-label="Mostrar ou ocultar confirma√ß√£o de senha"
                >
                  üëÅÔ∏è
                </button>
              </div>

              <!-- DICA DE SENHA -->
              <div class="rounded-2xl border border-amber-400/30 bg-amber-900/20 px-3 py-2.5 text-xs text-amber-100">
                Use uma senha forte combinando letras mai√∫sculas, min√∫sculas, n√∫meros e caracteres especiais.
              </div>

              <!-- BOT√ïES -->
              <div class="flex flex-col sm:flex-row gap-3 mt-2">
                <button
                  type="submit"
                  id="btnSubmitPassword"
                  class="inline-flex justify-center items-center gap-2 rounded-2xl bg-indigo-500 px-4 py-2.5 text-sm font-semibold text-white hover:bg-indigo-400 shadow shadow-indigo-500/40 transition disabled:opacity-60 disabled:cursor-not-allowed"
                >
                  Salvar nova senha
                </button>
                <button
                  type="button"
                  id="btnCancelPassword"
                  class="inline-flex justify-center items-center rounded-2xl border border-white/10 px-4 py-2.5 text-sm font-medium text-slate-100 hover:bg-white/10 transition"
                >
                  Cancelar
                </button>
              </div>
            </form>

            <p id="passwordChangeMsg" class="text-center text-sm mt-4"></p>
          </div>
        </div>

        <!-- CARD SESS√ÉO & CONTA (RESUMO + PIZZA + SESS√ÉO) -->
        <div
          id="cardSessaoConta"
          class="bg-slate-950/80 border border-white/10 rounded-3xl p-6 shadow-2xl shadow-black/50 backdrop-blur space-y-4 relative overflow-hidden"
        >
          <div class="pointer-events-none absolute -bottom-16 -right-20 h-40 w-40 rounded-full bg-sky-500/15 blur-3xl"></div>

          <div class="relative flex items-center justify-between gap-3">
            <div>
              <h2 class="text-base font-semibold text-slate-50">Sess√£o & Conta</h2>
              <p class="text-sm text-slate-300 mt-1">
                Veja um resumo visual dos chamados e gerencie a sess√£o atual.
              </p>
            </div>

            <!-- Abas desktop -->
            <div class="hidden sm:inline-flex rounded-2xl bg-slate-900/60 p-1 text-[11px]">
              <button
                type="button"
                id="tabResumo"
                class="px-3 py-1.5 rounded-2xl font-medium bg-slate-800 text-slate-50 shadow"
              >
                Resumo
              </button>
              <button
                type="button"
                id="tabSessao"
                class="px-3 py-1.5 rounded-2xl font-medium text-slate-300 hover:text-slate-50 hover:bg-slate-800/60 transition"
              >
                Sess√£o
              </button>
            </div>
          </div>

          <!-- Abas mobile -->
          <div class="sm:hidden relative mt-3 grid grid-cols-2 gap-2 text-xs">
            <button
              type="button"
              id="tabResumoMobile"
              class="px-3 py-2 rounded-2xl font-medium bg-slate-800 text-slate-50 shadow border border-white/10"
            >
              Resumo da conta
            </button>
            <button
              type="button"
              id="tabSessaoMobile"
              class="px-3 py-2 rounded-2xl font-medium text-slate-200 bg-slate-900/70 border border-white/10"
            >
              Sess√£o atual
            </button>
          </div>

          <!-- CONTE√öDO: RESUMO DA CONTA (USU√ÅRIO E ADMIN, COM PIZZA) -->
          <div id="resumoContaUsuario" class="relative mt-4 space-y-4">
            <div class="grid sm:grid-cols-2 gap-3 text-sm">
              <div class="rounded-2xl border border-sky-400/40 bg-sky-900/25 px-3 py-3 shadow-inner">
                <p class="text-[11px] uppercase tracking-[0.16em] text-sky-200 mb-1">
                  Chamados registrados
                </p>
                <p id="resumoTotal" class="text-2xl font-semibold text-slate-50">0</p>
                <p class="text-[11px] text-sky-100/80 mt-1">
                  Total de chamados considerados neste resumo.
                </p>
              </div>
              <div class="rounded-2xl border border-emerald-400/40 bg-emerald-900/25 px-3 py-3 shadow-inner">
                <p class="text-[11px] uppercase tracking-[0.16em] text-emerald-200 mb-1">
                  Hoje
                </p>
                <p id="resumoHoje" class="text-2xl font-semibold text-slate-50">0</p>
                <p class="text-[11px] text-emerald-100/80 mt-1">
                  Chamados criados na data de hoje.
                </p>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-2 text-xs">
              <div class="rounded-2xl border border-slate-500/40 bg-slate-900/40 px-3 py-2">
                <p class="text-[10px] uppercase tracking-[0.16em] text-slate-300 mb-1">
                  Em aberto
                </p>
                <p id="resumoAbertos" class="text-lg font-semibold text-slate-50">0</p>
              </div>
              <div class="rounded-2xl border border-amber-400/40 bg-amber-900/25 px-3 py-2">
                <p class="text-[10px] uppercase tracking-[0.16em] text-amber-200 mb-1">
                  Em andamento
                </p>
                <p id="resumoAndamento" class="text-lg font-semibold text-amber-50">0</p>
              </div>
              <div class="rounded-2xl border border-emerald-400/40 bg-emerald-900/25 px-3 py-2">
                <p class="text-[10px] uppercase tracking-[0.16em] text-emerald-200 mb-1">
                  Resolvidos
                </p>
                <p id="resumoResolvidos" class="text-lg font-semibold text-emerald-50">0</p>
              </div>
            </div>

            <!-- PIZZA -->
            <div class="flex flex-col sm:flex-row items-center gap-4 pt-1">
              <div class="relative h-28 w-28 sm:h-32 sm:w-32 flex items-center justify-center">
                <div
                  id="pieChart"
                  class="h-full w-full rounded-full bg-slate-800"
                ></div>
                <div class="absolute inset-4 rounded-full bg-slate-950 flex items-center justify-center">
                  <span id="pieCenter" class="text-[11px] text-slate-200 text-center leading-tight whitespace-pre-line">
                    0 chamados
                  </span>
                </div>
              </div>

              <div class="flex-1 space-y-1 text-[11px] text-slate-300">
                <p class="font-semibold text-slate-100 mb-1">
                  Distribui√ß√£o por status
                </p>
                <div class="flex items-center gap-2">
                  <span class="inline-block h-2.5 w-2.5 rounded-full bg-sky-400"></span>
                  <span>Em aberto</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="inline-block h-2.5 w-2.5 rounded-full bg-amber-400"></span>
                  <span>Em andamento</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="inline-block h-2.5 w-2.5 rounded-full bg-emerald-400"></span>
                  <span>Resolvidos</span>
                </div>
                <p id="resumoUltimo" class="mt-2">
                  √öltimo chamado considerado:
                  <span id="resumoUltimoData" class="text-slate-100">‚Äî</span>
                </p>
              </div>
            </div>

            <a
              id="linkFilaChamadosCard"
              href="chamados.html"
              class="inline-flex items-center gap-2 text-[11px] font-medium text-sky-300 hover:text-sky-200 hover:underline"
            >
              üìã Ver minha fila de chamados
            </a>
          </div>

          <!-- CONTE√öDO: SESS√ÉO ATUAL -->
          <div id="sessaoAtual" class="relative mt-4 space-y-4 hidden">
            <div class="rounded-2xl border border-white/10 bg-slate-900/70 px-3 py-3 text-sm">
              <p class="text-slate-300">
                Voc√™ est√° conectado como
                <span id="sessaoEmail" class="font-semibold text-slate-50">‚Äî</span>
                com perfil
                <span id="sessaoPerfil" class="font-semibold text-slate-100">‚Äî</span>.
              </p>
              <p class="text-[11px] text-slate-400 mt-1">
                Sua sess√£o √© mantida apenas neste navegador (localStorage). Para sair em seguran√ßa, encerre a sess√£o abaixo.
              </p>
            </div>

            <div class="grid sm:grid-cols-2 gap-3 text-sm">
              <button
                id="btnViewProfile"
                type="button"
                class="inline-flex items-center justify-center gap-2 rounded-2xl border border-white/10 bg-white/5 px-3 py-2.5 font-medium text-slate-50 hover:bg-white/10 hover:-translate-y-[1px] transition"
              >
                üë§ Exibir detalhes do perfil
              </button>

              <button
                id="logout2"
                class="inline-flex items-center justify-center gap-2 rounded-2xl bg-red-500/90 px-3 py-2.5 font-semibold text-white hover:bg-red-500 shadow-sm hover:-translate-y-[1px] transition"
              >
                ‚èª Encerrar sess√£o
              </button>
            </div>

            <p class="text-[11px] text-slate-400">
              Dica: altere sua senha periodicamente na se√ß√£o de
              <span class="font-semibold text-slate-100">Seguran√ßa da Conta</span>.
            </p>
          </div>
        </div>

        <!-- CARD CONFIGURA√á√ïES AVAN√áADAS -->
        <div class="bg-slate-950/70 border border-white/10 rounded-3xl p-6 shadow-2xl shadow-black/50 backdrop-blur space-y-4">
          <div class="flex items-center justify-between gap-3">
            <div>
              <h2 class="text-base font-semibold text-slate-50">Configura√ß√µes avan√ßadas</h2>
              <p class="text-sm text-slate-300 mt-1">
                Personalize os dados cadastrais e deixe sua conta alinhada ao seu perfil de uso.
              </p>
            </div>
            <button
              id="btnOpenEditModal2"
              class="hidden sm:inline-flex items-center gap-2 rounded-xl border border-white/10 px-3 py-2 text-xs font-medium text-slate-100 hover:bg-white/10 transition"
            >
              Editar dados
            </button>
          </div>

          <ul class="text-xs text-slate-300 space-y-1.5">
            <li>‚Ä¢ Atualize nome de exibi√ß√£o e telefone.</li>
            <li>‚Ä¢ E-mail e CPF s√£o exibidos como dados principais.</li>
            <li>‚Ä¢ Todas as altera√ß√µes s√£o salvas apenas neste dispositivo (localStorage).</li>
          </ul>

          <button
            id="btnOpenEditModalMobile"
            class="sm:hidden w-full inline-flex justify-center rounded-2xl border border-white/10 px-3 py-2.5 text-sm font-medium text-slate-50 hover:bg-white/10 transition"
          >
            Editar dados cadastrais
          </button>
        </div>

      </section>
    </div>
  </main>

  <!-- MODAL EDI√á√ÉO DE DADOS CADASTRAIS -->
  <div
    id="editProfileModal"
    class="fixed inset-0 z-40 hidden items-center justify-center bg-black/60 backdrop-blur-sm"
  >
    <div class="relative w-full max-w-md mx-4">
      <div class="bg-slate-950/95 border border-white/10 rounded-3xl shadow-2xl shadow-black/60 p-6 space-y-4">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h2 class="text-base font-semibold text-slate-50">Editar dados cadastrais</h2>
            <p class="text-sm text-slate-300 mt-1">
              Ajuste apenas as informa√ß√µes permitidas. E-mail e CPF s√£o exibidos como somente leitura.
            </p>
          </div>
          <button
            id="btnCloseEditModal"
            class="inline-flex items-center justify-center rounded-xl border border-white/10 w-8 h-8 text-slate-200 hover:bg-white/10 transition text-sm"
          >
            ‚úï
          </button>
        </div>

        <form id="formEditProfile" class="space-y-4 text-sm">
          <!-- Nome -->
          <div>
            <label for="editNome" class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
              Nome completo
            </label>
            <input
              id="editNome"
              type="text"
              required
              class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
              placeholder="Digite seu nome"
            />
          </div>

          <!-- Telefone -->
          <div>
            <label for="editTel" class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
              Telefone
            </label>
            <input
              id="editTel"
              type="tel"
              class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
              placeholder="(00) 00000-0000"
            />
          </div>

          <!-- E-mail (somente leitura) -->
          <div>
            <label class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
              E-mail (login)
            </label>
            <input
              id="editEmail"
              type="email"
              disabled
              class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 text-sm text-slate-400"
            />
          </div>

          <!-- CPF (somente leitura) -->
          <div>
            <label class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
              CPF
            </label>
            <input
              id="editCPF"
              type="text"
              disabled
              class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 text-sm text-slate-400"
            />
          </div>

          <p id="editProfileMsg" class="text-xs mt-1"></p>

          <div class="flex flex-col sm:flex-row gap-3 pt-2">
            <button
              type="submit"
              id="btnSubmitEditProfile"
              class="inline-flex justify-center items-center gap-2 rounded-2xl bg-emerald-500 px-4 py-2.5 text-sm font-semibold text-white hover:bg-emerald-400 shadow shadow-emerald-500/40 transition disabled:opacity-60 disabled:cursor-not-allowed"
            >
              Salvar altera√ß√µes
            </button>
            <button
              type="button"
              id="btnCancelEditProfile"
              class="inline-flex justify-center items-center rounded-2xl border border-white/10 px-4 py-2.5 text-sm font-medium text-slate-100 hover:bg-white/10 transition"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // ===================== UTILIT√ÅRIOS =====================
    function getSessionUser() {
      try {
        return JSON.parse(localStorage.getItem('sessionUser') || 'null');
      } catch {
        return null;
      }
    }

    function saveSessionUser(user) {
      localStorage.setItem('sessionUser', JSON.stringify(user));
    }

    function initials(nome) {
      return (nome || '')
        .split(' ')
        .filter(Boolean)
        .slice(0, 2)
        .map(s => s[0].toUpperCase())
        .join('') || '??';
    }

    function formatCPF(cpf) {
      const digits = (cpf || '').replace(/\D/g, '');
      if (digits.length !== 11) return cpf || '‚Äî';
      return digits.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    }

    function formatPhone(tel) {
      const digits = (tel || '').replace(/\D/g, '');
      if (digits.length === 11) {
        return digits.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
      }
      if (digits.length === 10) {
        return digits.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
      }
      return tel || '‚Äî';
    }

    function formatDateTime(iso) {
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return '‚Äî';
      return d.toLocaleString('pt-BR');
    }

    function togglePassword(btnId, inputId) {
      const btn = document.getElementById(btnId);
      const input = document.getElementById(inputId);
      if (!btn || !input) return;

      btn.addEventListener('click', () => {
        const visible = input.type === 'text';
        input.type = visible ? 'password' : 'text';
        btn.textContent = visible ? 'üëÅÔ∏è' : 'üôà';
      });
    }

    function setMessage(el, text, type) {
      if (!el) return;
      el.textContent = text || '';
      el.classList.remove('text-red-400', 'text-green-400', 'text-emerald-300', 'text-amber-300');
      if (type === 'error') el.classList.add('text-red-400');
      if (type === 'success') el.classList.add('text-green-400');
      if (type === 'info') el.classList.add('text-emerald-300');
      if (type === 'warn') el.classList.add('text-amber-300');
    }

    function badgeClass(status) {
      switch (status) {
        case 'Em andamento':
          return 'bg-amber-100 text-amber-900 ring-1 ring-amber-300';
        case 'Resolvido':
          return 'bg-emerald-100 text-emerald-900 ring-1 ring-emerald-300';
        case 'Em aberto':
        default:
          return 'bg-sky-100 text-sky-900 ring-1 ring-sky-300';
      }
    }

    // CHAMADOS
    function loadChamados() {
      try {
        return JSON.parse(localStorage.getItem('chamados') || '[]');
      } catch {
        return [];
      }
    }

    function normalizarDataLocal(dateObj) {
      const offsetMs = dateObj.getTimezoneOffset() * 60000;
      const local = new Date(dateObj.getTime() - offsetMs);
      return local.toISOString().slice(0, 10); // YYYY-MM-DD
    }

    function atualizarResumoChamadosUsuario(sess) {
      const elCount = document.getElementById('userChamadosCount');
      if (!elCount || !sess?.email) return;

      const chamados = loadChamados();
      const emailUsuario = (sess.email || '').toLowerCase();

      const meusChamados = chamados.filter(c =>
        (c.usuarioEmail || '').toLowerCase() === emailUsuario
      );

      const total = meusChamados.length;
      elCount.textContent = total === 1 ? '1 chamado' : `${total} chamados`;
    }

    // Preenche resumo (para usu√°rio: s√≥ dele; para admin: todos)
    function preencherResumoConta(isAdmin, sess) {
      const chamados = loadChamados();

      let listaBase;
      if (isAdmin) {
        listaBase = chamados; // todos os chamados (vis√£o dashboard)
      } else {
        const emailUsuario = (sess.email || '').toLowerCase();
        listaBase = chamados.filter(c =>
          (c.usuarioEmail || '').toLowerCase() === emailUsuario
        );
      }

      const hojeLocal = normalizarDataLocal(new Date());

      const total = listaBase.length;
      const hoje = listaBase.filter(c => {
        const d = new Date(c.criadoEm);
        if (Number.isNaN(d.getTime())) return false;
        return normalizarDataLocal(d) === hojeLocal;
      }).length;

      const abertos = listaBase.filter(c => c.status === 'Em aberto').length;
      const andamento = listaBase.filter(c => c.status === 'Em andamento').length;
      const resolvidos = listaBase.filter(c => c.status === 'Resolvido').length;

      const datasValidas = listaBase
        .map(c => new Date(c.criadoEm))
        .filter(d => !Number.isNaN(d.getTime()))
        .sort((a, b) => b - a);

      const resumoTotal = document.getElementById('resumoTotal');
      const resumoHoje = document.getElementById('resumoHoje');
      const resumoAbertos = document.getElementById('resumoAbertos');
      const resumoAndamento = document.getElementById('resumoAndamento');
      const resumoResolvidos = document.getElementById('resumoResolvidos');
      const resumoUltimoData = document.getElementById('resumoUltimoData');
      const pieChart = document.getElementById('pieChart');
      const pieCenter = document.getElementById('pieCenter');

      if (resumoTotal) resumoTotal.textContent = total;
      if (resumoHoje) resumoHoje.textContent = hoje;
      if (resumoAbertos) resumoAbertos.textContent = abertos;
      if (resumoAndamento) resumoAndamento.textContent = andamento;
      if (resumoResolvidos) resumoResolvidos.textContent = resolvidos;
      if (resumoUltimoData) {
        resumoUltimoData.textContent = datasValidas.length
          ? formatDateTime(datasValidas[0].toISOString())
          : '‚Äî';
      }

      if (!pieChart || !pieCenter) return;

      const totalStatus = abertos + andamento + resolvidos;

      if (totalStatus === 0) {
        pieChart.style.backgroundImage = 'radial-gradient(circle at 30% 30%, #1e293b, #020617)';
        pieCenter.textContent = 'Sem dados';
        return;
      }

      const degAbertos = (abertos / totalStatus) * 360;
      const degAndamento = (andamento / totalStatus) * 360;
      const degResolvidos = (resolvidos / totalStatus) * 360;

      const aEnd = degAbertos;
      const bEnd = degAbertos + degAndamento;

      pieChart.style.backgroundImage =
        `conic-gradient(
          rgb(56,189,248) 0deg ${aEnd}deg,
          rgb(250,204,21) ${aEnd}deg ${bEnd}deg,
          rgb(34,197,94) ${bEnd}deg 360deg
        )`;

      pieCenter.textContent = totalStatus === 1
        ? '1 chamado\npor status'
        : `${totalStatus} chamados\npor status`;
    }

    // ===================== INICIALIZA√á√ÉO =====================
    const sess = getSessionUser();
    if (!sess) {
      window.location.href = 'index.html';
    }

    const isAdmin = sess?.perfil === 'admin';

    // Elementos principais
    const avatarImg = document.getElementById('avatarImg');
    const avatarInitials = document.getElementById('avatarInitials');
    const pNome = document.getElementById('pNome');
    const pEmail = document.getElementById('pEmail');
    const pCPF = document.getElementById('pCPF');
    const pTel = document.getElementById('pTel');
    const perfilTexto = document.getElementById('perfilTexto');
    const chipPerfil = document.getElementById('chipPerfil');
    const passwordChangeMsg = document.getElementById('passwordChangeMsg');

    const headerSubtitle = document.getElementById('headerSubtitle');
    const headerTitle = document.getElementById('headerTitle');
    const linkPainelChamados = document.getElementById('linkPainelChamados');
    const linkPainelChamadosSidebar = document.getElementById('linkPainelChamadosSidebar');
    const linkFilaChamadosCard = document.getElementById('linkFilaChamadosCard');

    if (isAdmin) {
      if (headerSubtitle) headerSubtitle.textContent = '√Årea Administrativa';
      if (headerTitle) headerTitle.textContent = 'Minha Conta (Admin)';
      if (linkPainelChamados) linkPainelChamados.href = 'admin.html';
      if (linkPainelChamadosSidebar) linkPainelChamadosSidebar.href = 'admin.html';
      if (linkFilaChamadosCard) {
        linkFilaChamadosCard.href = 'admin.html';
        linkFilaChamadosCard.textContent = 'üìã Ver painel de chamados';
      }
    }

    function renderAvatar(user) {
      const avatarUrl = user?.avatar;
      if (avatarUrl) {
        avatarImg.src = avatarUrl;
        avatarImg.classList.remove('hidden');
        avatarInitials.classList.add('hidden');
      } else {
        avatarImg.src = '';
        avatarImg.classList.add('hidden');
        avatarInitials.textContent = initials(user?.nome);
        avatarInitials.classList.remove('hidden');
      }
    }

    function renderProfileInfo(user) {
      pNome.textContent = user?.nome || '‚Äî';
      pEmail.textContent = user?.email || '‚Äî';
      pCPF.textContent = user?.cpf ? formatCPF(user.cpf) : '‚Äî';
      pTel.textContent = user?.tel ? formatPhone(user.tel) : '‚Äî';

      const perfilLabel = user?.perfil === 'admin' ? 'Administrador' : 'Usu√°rio Padr√£o';
      perfilTexto.textContent = perfilLabel;
      if (chipPerfil) chipPerfil.textContent = perfilLabel;

      const sessaoEmailEl = document.getElementById('sessaoEmail');
      const sessaoPerfilEl = document.getElementById('sessaoPerfil');
      if (sessaoEmailEl) sessaoEmailEl.textContent = user?.email || '‚Äî';
      if (sessaoPerfilEl) sessaoPerfilEl.textContent = perfilLabel;

      renderAvatar(user);
    }

    renderProfileInfo(sess);
    atualizarResumoChamadosUsuario(sess);
    preencherResumoConta(isAdmin, sess);

    // ===================== LOGOUT =====================
    function doLogout() {
      localStorage.removeItem('sessionUser');
      window.location.href = 'index.html';
    }

    document.getElementById('logoutTop').addEventListener('click', doLogout);
    const logout2Btn = document.getElementById('logout2');
    if (logout2Btn) logout2Btn.addEventListener('click', doLogout);

    // ===================== AVATAR (FOTO DO USU√ÅRIO) =====================
    const btnChangeAvatar = document.getElementById('btnChangeAvatar');
    const avatarInput = document.getElementById('avatarInput');

    btnChangeAvatar.addEventListener('click', () => {
      avatarInput.click();
    });

    avatarInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        setMessage(passwordChangeMsg, 'Selecione um arquivo de imagem v√°lido para o avatar.', 'error');
        return;
      }

      const reader = new FileReader();
      reader.onload = () => {
        sess.avatar = reader.result;
        saveSessionUser(sess);
        renderAvatar(sess);
        setMessage(passwordChangeMsg, 'Foto atualizada com sucesso!', 'success');
      };
      reader.readAsDataURL(file);
    });

    // ===================== EXIBI√á√ÉO DE SENHA =====================
    togglePassword('toggleCurrentPassword', 'currentPassword');
    togglePassword('toggleNewPassword', 'newPassword');
    togglePassword('toggleConfirmPassword', 'confirmPassword');

    // ===================== ABRIR/FECHAR SE√á√ÉO DE SENHA =====================
    const changePasswordSection = document.getElementById('changePasswordSection');
    const btnChangePassword = document.getElementById('btnChangePassword');
    const btnChangePasswordMobile = document.getElementById('btnChangePasswordMobile');
    const btnCancelPassword = document.getElementById('btnCancelPassword');

    function toggleChangePasswordSection(show) {
      if (show === true) {
        changePasswordSection.classList.remove('hidden');
      } else if (show === false) {
        changePasswordSection.classList.add('hidden');
      } else {
        changePasswordSection.classList.toggle('hidden');
      }
      setMessage(passwordChangeMsg, '', null);
    }

    if (btnChangePassword) {
      btnChangePassword.addEventListener('click', () => toggleChangePasswordSection());
    }
    if (btnChangePasswordMobile) {
      btnChangePasswordMobile.addEventListener('click', () => toggleChangePasswordSection(true));
    }
    if (btnCancelPassword) {
      btnCancelPassword.addEventListener('click', () => toggleChangePasswordSection(false));
    }

    // ===================== ALTERAR SENHA =====================
    const formChangePassword = document.getElementById('formChangePassword');
    formChangePassword.addEventListener('submit', (e) => {
      e.preventDefault();
      const btnSubmit = document.getElementById('btnSubmitPassword');

      const currentPassword = document.getElementById('currentPassword').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();

      setMessage(passwordChangeMsg, '', null);

      if (typeof sess.senha === 'string') {
        if (currentPassword !== sess.senha) {
          setMessage(passwordChangeMsg, 'A senha atual est√° incorreta.', 'error');
          return;
        }
      } else {
        setMessage(passwordChangeMsg, 'N√£o foi poss√≠vel validar a senha atual. Fa√ßa login novamente se o problema persistir.', 'error');
        return;
      }

      if (newPassword.length < 6) {
        setMessage(passwordChangeMsg, 'A nova senha deve ter pelo menos 6 caracteres.', 'error');
        return;
      }

      if (newPassword === currentPassword) {
        setMessage(passwordChangeMsg, 'A nova senha n√£o pode ser igual √† senha atual.', 'error');
        return;
      }

      if (newPassword !== confirmPassword) {
        setMessage(passwordChangeMsg, 'As senhas novas n√£o coincidem.', 'error');
        return;
      }

      btnSubmit.disabled = true;

      sess.senha = newPassword;
      saveSessionUser(sess);

      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmPassword').value = '';

      setMessage(passwordChangeMsg, 'Senha alterada com sucesso!', 'success');
      btnSubmit.disabled = false;
    });

    // ===================== ABAS DO CARD SESS√ÉO & CONTA =====================
    const cardSessaoConta = document.getElementById('cardSessaoConta');
    const tabResumo = document.getElementById('tabResumo');
    const tabSessao = document.getElementById('tabSessao');
    const tabResumoMobile = document.getElementById('tabResumoMobile');
    const tabSessaoMobile = document.getElementById('tabSessaoMobile');
    const resumoContaUsuarioEl = document.getElementById('resumoContaUsuario');
    const sessaoAtualEl = document.getElementById('sessaoAtual');

    function ativarTab(tab) {
      const isResumo = tab === 'resumo';

      if (isResumo) {
        if (sessaoAtualEl) sessaoAtualEl.classList.add('hidden');
        if (resumoContaUsuarioEl) resumoContaUsuarioEl.classList.remove('hidden');
        preencherResumoConta(isAdmin, sess);
      } else {
        if (sessaoAtualEl) sessaoAtualEl.classList.remove('hidden');
        if (resumoContaUsuarioEl) resumoContaUsuarioEl.classList.add('hidden');
      }

      // Estilo abas desktop
      if (tabResumo && tabSessao) {
        if (isResumo) {
          tabResumo.classList.add('bg-slate-800', 'text-slate-50', 'shadow');
          tabSessao.classList.remove('bg-slate-800', 'text-slate-50', 'shadow');
          tabSessao.classList.add('text-slate-300');
        } else {
          tabSessao.classList.add('bg-slate-800', 'text-slate-50', 'shadow');
          tabResumo.classList.remove('bg-slate-800', 'text-slate-50', 'shadow');
          tabResumo.classList.add('text-slate-300');
        }
      }

      // Estilo abas mobile
      if (tabResumoMobile && tabSessaoMobile) {
        if (isResumo) {
          tabResumoMobile.classList.add('bg-slate-800', 'text-slate-50');
          tabResumoMobile.classList.remove('bg-slate-900/70');
          tabSessaoMobile.classList.remove('bg-slate-800', 'text-slate-50');
          tabSessaoMobile.classList.add('bg-slate-900/70');
        } else {
          tabSessaoMobile.classList.add('bg-slate-800', 'text-slate-50');
          tabSessaoMobile.classList.remove('bg-slate-900/70');
          tabResumoMobile.classList.remove('bg-slate-800', 'text-slate-50');
          tabResumoMobile.classList.add('bg-slate-900/70');
        }
      }
    }

    function destacarCardSessao() {
      if (!cardSessaoConta) return;
      cardSessaoConta.classList.add('ring-2', 'ring-sky-400/70');
      setTimeout(() => {
        cardSessaoConta.classList.remove('ring-2', 'ring-sky-400/70');
      }, 1000);
    }

    if (tabResumo) tabResumo.addEventListener('click', () => ativarTab('resumo'));
    if (tabSessao) tabSessao.addEventListener('click', () => ativarTab('sessao'));
    if (tabResumoMobile) tabResumoMobile.addEventListener('click', () => ativarTab('resumo'));
    if (tabSessaoMobile) tabSessaoMobile.addEventListener('click', () => ativarTab('sessao'));

    // Bot√£o da sidebar "Resumo da conta (atual)"
    const btnAtualResumo = document.getElementById('btnAtualResumo');
    if (btnAtualResumo) {
      btnAtualResumo.addEventListener('click', () => {
        ativarTab('resumo');
        cardSessaoConta?.scrollIntoView({ behavior: 'smooth', block: 'center' });
        destacarCardSessao();
      });
    }

    // Bot√£o "üë§ Exibir detalhes do perfil"
    const btnViewProfile = document.getElementById('btnViewProfile');
    if (btnViewProfile) {
      btnViewProfile.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // Aba padr√£o: Resumo
    ativarTab('resumo');

    // ===================== MODAL EDI√á√ÉO DE DADOS =====================
    const editProfileModal = document.getElementById('editProfileModal');
    const btnOpenEditModal = document.getElementById('btnOpenEditModal');
    const btnOpenEditModal2 = document.getElementById('btnOpenEditModal2');
    const btnOpenEditModalMobile = document.getElementById('btnOpenEditModalMobile');
    const btnCloseEditModal = document.getElementById('btnCloseEditModal');
    const btnCancelEditProfile = document.getElementById('btnCancelEditProfile');
    const formEditProfile = document.getElementById('formEditProfile');
    const editNome = document.getElementById('editNome');
    const editTel = document.getElementById('editTel');
    const editEmail = document.getElementById('editEmail');
    const editCPF = document.getElementById('editCPF');
    const editProfileMsg = document.getElementById('editProfileMsg');
    const btnSubmitEditProfile = document.getElementById('btnSubmitEditProfile');

    function openEditModal() {
      editNome.value = sess?.nome || '';
      editTel.value = sess?.tel ? formatPhone(sess.tel) : '';
      editEmail.value = sess?.email || '';
      editCPF.value = sess?.cpf ? formatCPF(sess.cpf) : '';
      setMessage(editProfileMsg, '', null);
      editProfileModal.classList.remove('hidden');
      editProfileModal.classList.add('flex');
    }

    function closeEditModal() {
      editProfileModal.classList.add('hidden');
      editProfileModal.classList.remove('flex');
      setMessage(editProfileMsg, '', null);
    }

    [btnOpenEditModal, btnOpenEditModal2, btnOpenEditModalMobile].forEach(btn => {
      if (btn) btn.addEventListener('click', openEditModal);
    });

    btnCloseEditModal.addEventListener('click', closeEditModal);
    btnCancelEditProfile.addEventListener('click', closeEditModal);

    // Fecha modal clicando no fundo
    editProfileModal.addEventListener('click', (e) => {
      if (e.target === editProfileModal) {
        closeEditModal();
      }
    });

    // Fecha modal com ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !editProfileModal.classList.contains('hidden')) {
        closeEditModal();
      }
    });

    // Formatar telefone ao sair do campo
    editTel.addEventListener('blur', () => {
      if (editTel.value.trim()) {
        editTel.value = formatPhone(editTel.value);
      }
    });

    // Salvar dados editados
    formEditProfile.addEventListener('submit', (e) => {
      e.preventDefault();
      btnSubmitEditProfile.disabled = true;
      setMessage(editProfileMsg, '', null);

      const newNome = editNome.value.trim();
      const newTelRaw = editTel.value.trim();

      if (!newNome) {
        setMessage(editProfileMsg, 'O nome n√£o pode ficar vazio.', 'error');
        btnSubmitEditProfile.disabled = false;
        return;
      }

      const telDigits = (newTelRaw || '').replace(/\D/g, '');
      if (newTelRaw && telDigits.length !== 10 && telDigits.length !== 11) {
        setMessage(editProfileMsg, 'Telefone inv√°lido. Use o formato (00) 00000-0000.', 'error');
        btnSubmitEditProfile.disabled = false;
        return;
      }

      sess.nome = newNome;
      sess.tel = telDigits || sess.tel || '';

      saveSessionUser(sess);
      renderProfileInfo(sess);
      atualizarResumoChamadosUsuario(sess);
      preencherResumoConta(isAdmin, sess);

      setMessage(editProfileMsg, 'Dados atualizados com sucesso!', 'success');

      setTimeout(() => {
        closeEditModal();
        btnSubmitEditProfile.disabled = false;
      }, 600);
    });
  </script>
</body>
</html>
