<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Suporte T√©cnico ‚Äî Cadastro</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { scroll-behavior: smooth; }
  </style>
</head>
<body class="min-h-screen bg-[#020617] text-slate-50 flex flex-col relative">

  <!-- FUNDO ANIMADO VANTA.GLOBE -->
  <div
    id="vanta-bg"
    class="fixed inset-0 -z-10"
  ></div>

  <!-- MAIN CENTRALIZADO -->
  <main class="flex-1 flex items-center justify-center px-4 pt-12">
    <!-- CARD CADASTRO -->
    <section class="bg-white/5 border border-white/10 rounded-3xl shadow-2xl shadow-black/60 backdrop-blur p-6 sm:p-8 w-full max-w-md mx-auto">
      <!-- LOGO + T√çTULO -->
      <div class="flex flex-col items-center gap-3 mb-4">
        <img
          src="logo-helptech.png"
          alt="Logo HelpTech"
          class="h-16 w-auto rounded-3xl shadow-xl shadow-black/60"
        />
        <div class="text-center">
          <h1 class="text-2xl font-semibold text-slate-50">
            Criar nova conta
          </h1>
          <p class="text-xs text-slate-300 mt-1">
            Preencha seus dados abaixo. Campos com * s√£o obrigat√≥rios.
          </p>
        </div>
      </div>

      <!-- LINK VOLTAR AO LOGIN (TOPO) -->
      <div class="flex justify-end mb-2">
        <a
          href="index.html"
          class="inline-flex items-center gap-1 rounded-xl border border-white/20 bg-white/5 px-3 py-1 text-[11px] font-medium text-slate-100 hover:bg-white/10 transition"
        >
          ‚¨Ö Voltar ao login
        </a>
      </div>

      <!-- FORM CADASTRO -->
      <form id="formCadastro" class="space-y-4 text-sm mt-4">
        <!-- Nome -->
        <div>
          <label for="nome" class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
            Nome completo *
          </label>
          <input
            id="nome"
            type="text"
            required
            maxlength="80"
            class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
            placeholder="Digite seu nome completo"
          />
        </div>

        <!-- E-mail -->
        <div>
          <label for="email" class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
            E-mail *
          </label>
          <input
            id="email"
            type="email"
            required
            maxlength="120"
            autocomplete="email"
            class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
            placeholder="seuemail@empresa.com"
          />
        </div>

        <!-- Telefone -->
        <div>
          <label for="telefone" class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
            Telefone (com DDD)
          </label>
          <input
            id="telefone"
            type="tel"
            maxlength="20"
            class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
            placeholder="(11) 99999-9999"
          />
        </div>

        <!-- CPF -->
        <div>
          <label for="cpf" class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
            CPF *
          </label>
          <input
            id="cpf"
            type="text"
            required
            maxlength="14"
            class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
            placeholder="000.000.000-00"
          />
        </div>

        <!-- Senha -->
        <div class="relative">
          <label for="senha" class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
            Senha *
          </label>
          <input
            id="senha"
            type="password"
            required
            minlength="6"
            maxlength="32"
            class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 pr-10 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
            placeholder="Crie uma senha"
          />
          <button
            type="button"
            id="toggleSenha"
            class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400 hover:text-slate-100 text-xs mt-6"
            aria-label="Mostrar ou ocultar senha"
          >
            üëÅÔ∏è
          </button>
        </div>

        <!-- Confirmar Senha -->
        <div class="relative">
          <label for="confirmarSenha" class="block text-xs font-semibold tracking-[0.16em] uppercase mb-1 text-slate-300">
            Confirmar senha *
          </label>
          <input
            id="confirmarSenha"
            type="password"
            required
            minlength="6"
            maxlength="32"
            class="w-full rounded-2xl border border-white/15 bg-slate-900/60 px-3 py-2.5 pr-10 text-sm text-slate-50 placeholder:text-slate-500 focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none"
            placeholder="Repita a senha"
          />
          <button
            type="button"
            id="toggleConfirmarSenha"
            class="absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400 hover:text-slate-100 text-xs mt-6"
            aria-label="Mostrar ou ocultar confirma√ß√£o de senha"
          >
            üëÅÔ∏è
          </button>
        </div>

        <!-- Mensagem -->
        <p id="cadMsg" class="text-xs mt-1"></p>

        <!-- BOT√ïES -->
        <div class="flex flex-col sm:flex-row gap-3 pt-2">
          <button
            type="submit"
            id="btnSubmitCadastro"
            class="w-full sm:w-auto inline-flex justify-center items-center gap-2 rounded-2xl bg-indigo-500 px-4 py-2.5 text-sm font-semibold text-white hover:bg-indigo-400 shadow shadow-indigo-500/40 transition disabled:opacity-60 disabled:cursor-not-allowed"
          >
             Criar conta
          </button>
          <a
            href="index.html"
            class="w-full sm:w-auto inline-flex justify-center items-center gap-2 rounded-2xl border border-white/15 bg-white/5 px-4 py-2.5 text-sm font-medium text-slate-100 hover:bg-white/10 transition"
          >
            J√° tenho conta
          </a>
        </div>
      </form>
    </section>
  </main>

  <!-- SCRIPTS: THREE + VANTA.GLOBE (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>

  <script>
    // ===================== INICIALIZA VANTA.GLOBE ATR√ÅS DO FORMUL√ÅRIO =====================
    let vantaEffect = null;
    window.addEventListener('load', () => {
      if (window.VANTA && window.VANTA.GLOBE) {
        vantaEffect = VANTA.GLOBE({
          el: "#vanta-bg",
          mouseControls: true,
          touchControls: true,
          gyroControls: false,
          minHeight: 200.00,
          minWidth: 200.00,
          scale: 1.00,
          scaleMobile: 1.00,
          color: 0x818cf8,          // linhas em indigo
          backgroundColor: 0x020617 // fundo escuro padr√£o
        });
      } else {
        console.error("VANTA.GLOBE n√£o carregou.");
      }
    });

    // ===== UTILIT√ÅRIOS =====
    function getUsuariosCadastrados() {
      try {
        const raw = localStorage.getItem('usuarios') || localStorage.getItem('users');
        return raw ? JSON.parse(raw) : [];
      } catch {
        return [];
      }
    }

    function saveUsuarios(lista) {
      localStorage.setItem('usuarios', JSON.stringify(lista));
    }

    function saveSessionUser(user) {
      localStorage.setItem('sessionUser', JSON.stringify(user));
    }

    function setCadMsg(text, type) {
      const el = document.getElementById('cadMsg');
      el.textContent = text || '';
      el.className = 'text-xs mt-1';
      if (type === 'error') el.classList.add('text-red-400');
      if (type === 'success') el.classList.add('text-green-400');
      if (type === 'info') el.classList.add('text-slate-300');
    }

    function limparMascara(value) {
      return (value || '').replace(/\D/g, '');
    }

    function formatPhoneBR(value) {
      const digits = limparMascara(value).slice(0, 11);
      if (digits.length <= 2) return digits;
      if (digits.length <= 6) {
        return `(${digits.slice(0, 2)}) ${digits.slice(2)}`;
      }
      if (digits.length <= 10) {
        return `(${digits.slice(0, 2)}) ${digits.slice(2, 6)}-${digits.slice(6)}`;
      }
      return `(${digits.slice(0, 2)}) ${digits.slice(2, 7)}-${digits.slice(7)}`;
    }

    function formatCPF(value) {
      const digits = limparMascara(value).slice(0, 11);
      if (digits.length <= 3) return digits;
      if (digits.length <= 6) return `${digits.slice(0, 3)}.${digits.slice(3)}`;
      if (digits.length <= 9) return `${digits.slice(0, 3)}.${digits.slice(3, 6)}.${digits.slice(6)}`;
      return `${digits.slice(0, 3)}.${digits.slice(3, 6)}.${digits.slice(6, 9)}-${digits.slice(9)}`;
    }

    // ===== ELEMENTOS =====
    const formCadastro = document.getElementById('formCadastro');
    const btnSubmitCadastro = document.getElementById('btnSubmitCadastro');
    const inputTelefone = document.getElementById('telefone');
    const inputCPF = document.getElementById('cpf');
    const inputSenha = document.getElementById('senha');
    const inputConfirmarSenha = document.getElementById('confirmarSenha');

    // M√°scaras simples ao sair do campo
    inputTelefone.addEventListener('blur', () => {
      if (inputTelefone.value.trim()) {
        inputTelefone.value = formatPhoneBR(inputTelefone.value);
      }
    });

    inputCPF.addEventListener('blur', () => {
      if (inputCPF.value.trim()) {
        inputCPF.value = formatCPF(inputCPF.value);
      }
    });

    // Mostrar / ocultar senhas
    function togglePassword(btnId, input) {
      const btn = document.getElementById(btnId);
      btn.addEventListener('click', () => {
        const isText = input.type === 'text';
        input.type = isText ? 'password' : 'text';
        btn.textContent = isText ? 'üëÅÔ∏è' : 'üôà';
      });
    }

    togglePassword('toggleSenha', inputSenha);
    togglePassword('toggleConfirmarSenha', inputConfirmarSenha);

    // ===== SUBMIT DO FORM =====
    formCadastro.addEventListener('submit', (e) => {
      e.preventDefault();
      setCadMsg('', null);

      const nome = document.getElementById('nome').value.trim();
      const email = document.getElementById('email').value.trim();
      const telefone = document.getElementById('telefone').value.trim();
      const cpf = document.getElementById('cpf').value.trim();
      const senha = inputSenha.value.trim();
      const confirmarSenha = inputConfirmarSenha.value.trim();

      if (!nome || !email || !cpf || !senha || !confirmarSenha) {
        setCadMsg('Preencha todos os campos obrigat√≥rios (*).', 'error');
        return;
      }

      if (nome.length > 80) {
        setCadMsg('O nome excede o limite de 80 caracteres.', 'error');
        return;
      }

      if (email.length > 120) {
        setCadMsg('O e-mail excede o limite de 120 caracteres.', 'error');
        return;
      }

      const telDigits = limparMascara(telefone);
      if (telefone && telDigits.length !== 10 && telDigits.length !== 11) {
        setCadMsg('Telefone inv√°lido. Use um n√∫mero com DDD (10 ou 11 d√≠gitos).', 'error');
        return;
      }

      const cpfDigits = limparMascara(cpf);
      if (cpfDigits.length !== 11) {
        setCadMsg('CPF inv√°lido. Informe 11 d√≠gitos.', 'error');
        return;
      }

      if (senha.length < 6 || senha.length > 32) {
        setCadMsg('A senha deve ter entre 6 e 32 caracteres.', 'error');
        return;
      }

      if (senha !== confirmarSenha) {
        setCadMsg('As senhas n√£o conferem. Verifique.', 'error');
        return;
      }

      // Verificar se j√° existe usu√°rio com esse e-mail
      const usuarios = getUsuariosCadastrados();
      const jaExiste = usuarios.some(u => (u.email || '').toLowerCase() === email.toLowerCase());

      if (jaExiste) {
        setCadMsg('J√° existe uma conta cadastrada com este e-mail.', 'error');
        return;
      }

      // Monta objeto de usu√°rio
      const novoUsuario = {
        nome,
        email,
        tel: telefone,
        cpf,
        senha,
        avatar: null,
        perfil: 'usuario'
      };

      usuarios.push(novoUsuario);
      saveUsuarios(usuarios);

      // Cria sess√£o
      const sessionUser = {
        nome,
        email,
        cpf,
        tel: telefone,
        senha,
        avatar: null,
        perfil: 'usuario'
      };
      saveSessionUser(sessionUser);

      setCadMsg('Cadastro realizado com sucesso! Redirecionando...', 'success');

      btnSubmitCadastro.disabled = true;

      setTimeout(() => {
        window.location.href = 'index.html';
      }, 800);
    });
  </script>
</body>
</html>
